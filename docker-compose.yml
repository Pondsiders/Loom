# The Loom - Development Configuration

services:
  loom:
    dns:
      - ${TAILSCALE_DNS:-100.100.100.100}
      - ${PUBLIC_DNS:-1.1.1.1}
    dns_search:
      - ${TAILSCALE_SEARCH:-tail8bd569.ts.net}
    build: .
    ports:
      - "18080:8080"  # Dev port
    volumes:
      - ./src/loom:/app/src/loom:ro  # Hot reload Loom code
      - ./prompts:/app/prompts:ro    # Hot reload prompts
      - /home/jefferyharrell/.claude:/home/jefferyharrell/.claude:ro  # Transcript files
      - /Pondside/Alpha-Home:/Pondside/Alpha-Home:ro  # System prompt fallback
    environment:
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://alpha-pi:4318
      - OTEL_SERVICE_NAME=loom-dev
      - REDIS_URL=redis://alpha-pi:6379
      - CLAUDE_DATA_DIR=/home/jefferyharrell/.claude
    command: ["uvicorn", "loom.app:app", "--host", "0.0.0.0", "--port", "8080", "--reload"]
    restart: unless-stopped
